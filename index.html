<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∫—É—Ö–Ω–∏ MVP</title>
    <style>
        /* Reset –∏ –±–∞–∑–æ–≤—ã–µ —Å—Ç–∏–ª–∏ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            font-size: 14px;
            line-height: 1.6;
            color: #333;
            background-color: #f5f5f5;
            padding: 20px;
        }

        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .section h2 {
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #007bff;
            color: #007bff;
        }

        .section h3 {
            margin: 15px 0 10px;
            color: #555;
        }

        /* –§–æ—Ä–º—ã */
        form {
            margin: 15px 0;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        input[type="text"],
        input[type="password"],
        input[type="email"],
        input[type="tel"],
        input[type="number"],
        select,
        textarea {
            width: 100%;
            padding: 8px 12px;
            margin-bottom: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        textarea {
            min-height: 80px;
            resize: vertical;
        }

        input[type="number"] {
            width: auto;
            min-width: 100px;
        }

        /* –ö–Ω–æ–ø–∫–∏ */
        button,
        .btn {
            padding: 10px 20px;
            margin: 5px 5px 5px 0;
            border: none;
            border-radius: 4px;
            background-color: #007bff;
            color: white;
            font-size: 14px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        button:hover,
        .btn:hover {
            background-color: #0056b3;
        }

        button.secondary {
            background-color: #6c757d;
        }

        button.secondary:hover {
            background-color: #545b62;
        }

        button.danger {
            background-color: #dc3545;
        }

        button.danger:hover {
            background-color: #c82333;
        }

        button.success {
            background-color: #28a745;
        }

        button.success:hover {
            background-color: #218838;
        }

        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
        #navigation {
            margin-bottom: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 4px;
        }

        #navigation button {
            margin-right: 10px;
        }

        /* –ö–∞—Ä—Ç–æ—á–∫–∏ */
        .card {
            padding: 15px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: #fff;
        }

        .card:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .card-title {
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .card-content {
            margin-bottom: 10px;
            color: #666;
        }

        /* –¢–∞–±–ª–∏—Ü—ã */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }

        table th,
        table td {
            padding: 10px;
            border: 1px solid #ddd;
            text-align: left;
        }

        table th {
            background-color: #f8f9fa;
            font-weight: bold;
        }

        table tr:hover {
            background-color: #f8f9fa;
        }

        /* –ì—Ä—É–ø–ø—ã –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ */
        .component-group {
            margin: 20px 0;
        }

        .component-row {
            display: flex;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }

        .component-row label {
            flex: 1;
            margin: 0;
            font-weight: normal;
        }

        .component-row input {
            margin: 0 10px;
        }

        .component-row .price {
            min-width: 120px;
            text-align: right;
            font-weight: bold;
            color: #007bff;
        }

        /* –°–∫—Ä—ã—Ç—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã */
        .hidden {
            display: none !important;
        }

        /* –°–æ–æ–±—â–µ–Ω–∏—è */
        .message {
            padding: 12px;
            margin: 10px 0;
            border-radius: 4px;
        }

        .message.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .message.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .message.info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        /* –ü–æ–∏—Å–∫ */
        .search-box {
            margin: 15px 0;
        }

        .search-box input {
            display: inline-block;
            width: 300px;
            margin-right: 10px;
        }

        /* –†–µ–∑—É–ª—å—Ç–∞—Ç—ã */
        .result-summary {
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 4px;
            margin: 20px 0;
        }

        .result-summary .total {
            font-size: 24px;
            font-weight: bold;
            color: #28a745;
            margin-top: 10px;
        }

        /* –ß–µ–∫–±–æ–∫—Å—ã */
        input[type="checkbox"] {
            width: auto;
            margin-right: 8px;
        }

        /* –§–æ—Ä–º–∞ –≤—Ö–æ–¥–∞ */
        #authBlock {
            max-width: 400px;
            margin: 100px auto;
            padding: 30px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        #authBlock h1 {
            margin-bottom: 20px;
            text-align: center;
            color: #007bff;
        }

        #authBlock form {
            margin: 0;
        }

        #authBlock button {
            width: 100%;
        }
    </style>
</head>
<body>
    <!-- –ë–ª–æ–∫ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ -->
    <div id="authBlock">
        <h1>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∫—É—Ö–Ω–∏</h1>
        <form id="loginForm">
            <label>–õ–æ–≥–∏–Ω</label>
            <input type="text" id="username" required autocomplete="username">

            <label>–ü–∞—Ä–æ–ª—å</label>
            <input type="password" id="password" required autocomplete="current-password">

            <button type="submit">–í–æ–π—Ç–∏</button>
        </form>
        <div id="loginMessage"></div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (—Å–∫—Ä—ã—Ç–æ –¥–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏) -->
    <div id="app" class="hidden">
        <div class="container">
            <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
            <div id="navigation">
                <button onclick="showSection('clients')">–ö–ª–∏–µ–Ω—Ç—ã</button>
                <button onclick="showSection('calculator')">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</button>
                <button onclick="showSection('comparison')">–°—Ä–∞–≤–Ω–µ–Ω–∏–µ</button>
                <button onclick="showSection('history')">–ò—Å—Ç–æ—Ä–∏—è</button>
                <button id="adminPricesBtn" class="hidden" onclick="showSection('prices')">–¶–µ–Ω—ã (–ê–¥–º–∏–Ω)</button>
                <button id="adminDiscountsBtn" class="hidden" onclick="showSection('discounts')">–°–∫–∏–¥–∫–∏ (–ê–¥–º–∏–Ω)</button>
                <button onclick="logout()" class="secondary" style="float: right;">–í—ã—Ö–æ–¥</button>
                <span id="userInfo" style="float: right; margin: 10px 20px; font-weight: bold;"></span>
            </div>

            <!-- –ë–ª–æ–∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞–º–∏ -->
            <div id="clientsBlock" class="section hidden">
                <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞–º–∏</h2>

                <div class="search-box">
                    <h3>–ü–æ–∏—Å–∫ –∫–ª–∏–µ–Ω—Ç–∞</h3>
                    <input type="text" id="searchInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –§–ò–û –¥–ª—è –ø–æ–∏—Å–∫–∞">
                    <button onclick="searchClients()">–ù–∞–π—Ç–∏</button>
                    <button onclick="showAllClients()" class="secondary">–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ—Ö</button>
                </div>

                <div id="clientForm" class="hidden">
                    <h3>–ù–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç</h3>
                    <form id="clientFormElement">
                        <label>–§–∞–º–∏–ª–∏—è *</label>
                        <input type="text" id="clientLastName" required>

                        <label>–ò–º—è *</label>
                        <input type="text" id="clientFirstName" required>

                        <label>–û—Ç—á–µ—Å—Ç–≤–æ</label>
                        <input type="text" id="clientMiddleName">

                        <label>–¢–µ–ª–µ—Ñ–æ–Ω</label>
                        <input type="tel" id="clientPhone">

                        <label>Email</label>
                        <input type="email" id="clientEmail">

                        <label>–ê–¥—Ä–µ—Å</label>
                        <textarea id="clientAddress"></textarea>

                        <button type="submit" class="success">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞</button>
                        <button type="button" onclick="hideClientForm()" class="secondary">–û—Ç–º–µ–Ω–∞</button>
                    </form>
                </div>

                <button onclick="showClientForm()">–î–æ–±–∞–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞</button>

                <h3>–°–ø–∏—Å–æ–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤</h3>
                <div id="clientsList"></div>
            </div>

            <!-- –ë–ª–æ–∫ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ -->
            <div id="calculatorBlock" class="section hidden">
                <h2>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</h2>
                <div id="calculatorContent">
                    <p class="message info">–í—ã–±–µ—Ä–∏—Ç–µ –∫–ª–∏–µ–Ω—Ç–∞ –≤ —Ä–∞–∑–¥–µ–ª–µ "–ö–ª–∏–µ–Ω—Ç—ã" –¥–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞—Å—á–µ—Ç–∞</p>
                </div>
            </div>

            <!-- –ë–ª–æ–∫ –º–∞—Ç—Ä–∏—Ü—ã —Å—Ä–∞–≤–Ω–µ–Ω–∏—è -->
            <div id="comparisonBlock" class="section hidden">
                <h2>–ú–∞—Ç—Ä–∏—Ü–∞ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤</h2>
                <div id="comparisonContent"></div>
            </div>

            <!-- –ë–ª–æ–∫ –∏—Å—Ç–æ—Ä–∏–∏ —Ä–∞—Å—á–µ—Ç–æ–≤ -->
            <div id="historyBlock" class="section hidden">
                <h2>–ò—Å—Ç–æ—Ä–∏—è —Ä–∞—Å—á–µ—Ç–æ–≤</h2>
                <div id="historyContent"></div>
            </div>

            <!-- –ë–ª–æ–∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ü–µ–Ω–∞–º–∏ (—Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω) -->
            <div id="pricesBlock" class="section hidden">
                <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω–∞–º–∏</h2>
                <div id="pricesContent"></div>
            </div>

            <!-- –ë–ª–æ–∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–∫–∏–¥–∫–∞–º–∏ (—Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω) -->
            <div id="discountsBlock" class="section hidden">
                <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∫–∏–¥–∫–∞–º–∏</h2>
                <div id="discountsContent"></div>
            </div>
        </div>
    </div>

    <script>
        // ========================================
        // –ë–õ–û–ö 2: –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø –ò –ù–ê–í–ò–ì–ê–¶–ò–Ø
        // ========================================

        // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–∏—Å—Ç–µ–º—ã
        const USERS = {
            'admin': {
                password: 'admin123',
                role: 'admin',
                code: 'ADM',
                name: '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä'
            },
            'manager': {
                password: 'manager123',
                role: 'manager',
                code: 'MAN',
                name: '–ú–µ–Ω–µ–¥–∂–µ—Ä'
            }
        };

        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let currentUser = null;
        let prices = {};
        let countertopPrices = {}; // –¶–µ–Ω—ã –Ω–∞ —Å—Ç–æ–ª–µ—à–Ω–∏—Ü—ã —Ç–∏–ø–∞ "auto"
        let clients = [];
        let calculations = [];
        let discounts = [];
        let currentCalculation = null;
        let calculationCounter = {};

        // –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
        const components = [
            { id: 1, name: "–ù–∏–∂–Ω–∏–π –º–æ–¥—É–ª—å", unit: "–ø.–º.", category: "–ö–æ—Ä–ø—É—Å–∞", isDiscount: false },
            { id: 2, name: "–í–µ—Ä—Ö–Ω–∏–π –º–æ–¥—É–ª—å 720 –º–º", unit: "–ø.–º.", category: "–ö–æ—Ä–ø—É—Å–∞", isDiscount: false },
            { id: 3, name: "–ü–µ–Ω–∞–ª (–≤—ã—Å–æ–∫–∏–π —à–∫–∞—Ñ) 600√ó2550 –º–º", unit: "—à—Ç.", category: "–ö–æ—Ä–ø—É—Å–∞", isDiscount: false },
            { id: 4, name: "–í—Ç–æ—Ä–æ–π —è—Ä—É—Å 450 –º–º (–≤–µ—Ä—Ö–Ω–∏–π —à–∫–∞—Ñ)", unit: "—à—Ç.", category: "–ö–æ—Ä–ø—É—Å–∞", isDiscount: false },
            { id: 5, name: "–ù–∏–∂–Ω–∏–π —É–≥–ª–æ–≤–æ–π –º–æ–¥—É–ª—å 90¬∞", unit: "—à—Ç.", category: "–£–≥–ª—ã", isDiscount: true },
            { id: 6, name: "–í–µ—Ä—Ö–Ω–∏–π —É–≥–ª–æ–≤–æ–π –º–æ–¥—É–ª—å 90¬∞", unit: "—à—Ç.", category: "–£–≥–ª—ã", isDiscount: true },
            { id: 7, name: "–í–µ—Ä—Ö–Ω–∏–µ —à–∫–∞—Ñ—ã 920 –º–º", unit: "–ø.–º.", category: "–ö–æ—Ä–ø—É—Å–∞", isDiscount: false },
            { id: 8, name: "–Ø—â–∏–∫ 500 –º–º (—à–∞—Ä–∏–∫–æ–≤—ã–µ –Ω–∞–ø—Ä–∞–≤–ª—è—é—â–∏–µ)", unit: "—à—Ç.", category: "–§—É—Ä–Ω–∏—Ç—É—Ä–∞", isDiscount: false },
            { id: 9, name: "–Ø—â–∏–∫ 500 –º–º (—Å–∫—Ä—ã—Ç—ã–µ –Ω–∞–ø—Ä–∞–≤–ª—è—é—â–∏–µ)", unit: "—à—Ç.", category: "–§—É—Ä–Ω–∏—Ç—É—Ä–∞", isDiscount: false },
            { id: 10, name: "–Ø—â–∏–∫ 500 –º–º (Blum Tandem)", unit: "—à—Ç.", category: "–§—É—Ä–Ω–∏—Ç—É—Ä–∞", isDiscount: false },
            { id: 11, name: "–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π —è—â–∏–∫ 750 –º–º (—Å –ø–æ–≤–æ–¥–∫–æ–º)", unit: "—à—Ç.", category: "–§—É—Ä–Ω–∏—Ç—É—Ä–∞", isDiscount: false },
            { id: 12, name: "–ü—Ä–æ—Ñ–∏–ª—å Gola L", unit: "—à—Ç.", category: "–†—É—á–∫–∏", isDiscount: false },
            { id: 13, name: "–ü—Ä–æ—Ñ–∏–ª—å Gola C", unit: "—à—Ç.", category: "–†—É—á–∫–∏", isDiscount: false },
            { id: 14, name: "–ü—Ä–æ—Ñ–∏–ª—å Gola (–¥–ª—è –≤–µ—Ä—Ö–Ω–∏—Ö —à–∫–∞—Ñ–æ–≤)", unit: "—à—Ç.", category: "–†—É—á–∫–∏", isDiscount: false },
            { id: 15, name: "–°—Ç–µ–Ω–æ–≤–∞—è –ø–∞–Ω–µ–ª—å 1 –º (–°–∫–∏—Ñ)", unit: "–ø.–º.", category: "–î–µ–∫–æ—Ä", isDiscount: false },
            { id: 16, name: "–ü–æ–¥—ä—ë–º–Ω–∏–∫ HF —Å–∫–ª–∞–¥–Ω–æ–π (ST)", unit: "—à—Ç.", category: "–ú–µ—Ö–∞–Ω–∏–∑–º—ã", isDiscount: false },
            { id: 17, name: "–ü–æ–¥—ä—ë–º–Ω–∏–∫ HK-S –∫–æ—Ä–æ—Ç–∫–∏–π (SQ)", unit: "—à—Ç.", category: "–ú–µ—Ö–∞–Ω–∏–∑–º—ã", isDiscount: false },
            { id: 18, name: "–ü–æ–¥—ä—ë–º–Ω–∏–∫ HK-XS (—Ä—ã—á–∞–≥–∏) (SE)", unit: "—à—Ç.", category: "–ú–µ—Ö–∞–Ω–∏–∑–º—ã", isDiscount: false },
            { id: 19, name: "–°—É—à–∫–∞ –¥–ª—è –ø–æ—Å—É–¥—ã", unit: "—à—Ç.", category: "–ê–∫—Å–µ—Å—Å—É–∞—Ä—ã", isDiscount: false },
            { id: 20, name: "–†—É—á–∫–∏ (–æ–±—ã—á–Ω—ã–µ)", unit: "—à—Ç.", category: "–†—É—á–∫–∏", isDiscount: false },
            { id: 21, name: "–ü–æ–¥—ä—ë–º–Ω–∏–∫ –≥–∞–∑–ª–∏—Ñ—Ç", unit: "—à—Ç.", category: "–ú–µ—Ö–∞–Ω–∏–∑–º—ã", isDiscount: false },
            { id: 22, name: "–†–∞–º–∫–∞ –ø–æ–¥ —Å—Ç–µ–∫–ª–æ", unit: "–ø.–º.", category: "–î–µ–∫–æ—Ä", isDiscount: false },
            { id: 23, name: "–°—Ç–µ–∫–ª–æ", unit: "—à—Ç.", category: "–î–µ–∫–æ—Ä", isDiscount: false },
            { id: 24, name: "–ü–æ–¥—Å–≤–µ—Ç–∫–∞ LED", unit: "–ø.–º.", category: "–û—Å–≤–µ—â–µ–Ω–∏–µ", isDiscount: false },
            { id: 25, name: "–ï–≤—Ä–æ—Å—Ç—ã–∫–æ–≤–∫–∞", unit: "—à—Ç.", category: "–ê–∫—Å–µ—Å—Å—É–∞—Ä—ã", isDiscount: false }
        ];

        // –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
        const config = {
            facades: [
                { id: "mdf_mylo", name: "–ú–î–§ –ú—ã–ª–æ 3,4,5" },
                { id: "mdf_premium", name: "–ú–î–§ 345 Premium" },
                { id: "mdf_country", name: "–ú–î–§ 345 –ö–∞—É–Ω—Ç—Ä–∏" },
                { id: "mdf_london", name: "–ú–î–§ 345 –õ–æ–Ω–¥–æ–Ω" },
                { id: "kraska_mat", name: "–ö—Ä–∞—Å–∫–∞ –ú–ê–¢" },
                { id: "kraska_gl", name: "–ö—Ä–∞—Å–∫–∞ –ì–õ–Ø–ù–ï–¶" },
                { id: "kraska_mat_fr", name: "–ö—Ä–∞—Å–∫–∞ –ú–ê–¢ (–§–†)" },
                { id: "kraska_gl_fr", name: "–ö—Ä–∞—Å–∫–∞ –ì–õ–Ø–ù–ï–¶ (–§–†)" },
                { id: "agt", name: "AGT (1,23)" },
                { id: "eterno_pet", name: "–ï—Ç–µ—Ä–Ω–æ (–ü–≠–¢)" },
                { id: "eterno_etl", name: "–ï—Ç–µ—Ä–Ω–æ ETL" },
                { id: "eterno_ets", name: "–ï—Ç–µ—Ä–Ω–æ ETS" },
                { id: "eterno_etm", name: "–ï—Ç–µ—Ä–Ω–æ ETM" },
                { id: "uf_pfl", name: "–£–§ (–ü–§–õ)" }
            ],
            countertops: [
                { id: "ldsp_28", name: "–õ–î–°–ü 28–º–º", type: "auto", pricePerMeter: 0 },
                { id: "ldsp_40", name: "–õ–î–°–ü 40–º–º", type: "auto", pricePerMeter: 0 },
                { id: "acrylic", name: "–ê–∫—Ä–∏–ª", type: "manual" },
                { id: "quartz", name: "–ö–≤–∞—Ä—Ü", type: "manual" }
            ]
        };

        // ========================================
        // –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø
        // ========================================

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ñ–æ—Ä–º—ã –≤—Ö–æ–¥–∞
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;
            login(username, password);
        });

        // –§—É–Ω–∫—Ü–∏—è –≤—Ö–æ–¥–∞
        function login(username, password) {
            const messageDiv = document.getElementById('loginMessage');

            if (USERS[username] && USERS[username].password === password) {
                currentUser = {
                    username: username,
                    role: USERS[username].role,
                    code: USERS[username].code,
                    name: USERS[username].name
                };

                // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ sessionStorage
                sessionStorage.setItem('currentUser', JSON.stringify(currentUser));

                // –°–∫—Ä—ã—Ç—å —Ñ–æ—Ä–º—É –≤—Ö–æ–¥–∞
                document.getElementById('authBlock').classList.add('hidden');

                // –ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
                document.getElementById('app').classList.remove('hidden');

                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
                initializeApp();

                // –û—á–∏—Å—Ç–∏—Ç—å —Ñ–æ—Ä–º—É
                document.getElementById('loginForm').reset();
                messageDiv.innerHTML = '';
            } else {
                messageDiv.innerHTML = '<div class="message error">–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å</div>';
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –≤—ã—Ö–æ–¥–∞
        function logout() {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏?')) {
                currentUser = null;
                sessionStorage.removeItem('currentUser');
                localStorage.removeItem('currentCalculation');

                // –°–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
                document.getElementById('app').classList.add('hidden');

                // –ü–æ–∫–∞–∑–∞—Ç—å —Ñ–æ—Ä–º—É –≤—Ö–æ–¥–∞
                document.getElementById('authBlock').classList.remove('hidden');

                // –°–∫—Ä—ã—Ç—å –≤—Å–µ —Å–µ–∫—Ü–∏–∏
                hideAllSections();
            }
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        function checkAuth() {
            const savedUser = sessionStorage.getItem('currentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                document.getElementById('authBlock').classList.add('hidden');
                document.getElementById('app').classList.remove('hidden');
                initializeApp();
            }
        }

        // ========================================
        // –ù–ê–í–ò–ì–ê–¶–ò–Ø
        // ========================================

        // –ü–æ–∫–∞–∑–∞—Ç—å —Å–µ–∫—Ü–∏—é
        function showSection(sectionName) {
            // –°–∫—Ä—ã—Ç—å –≤—Å–µ —Å–µ–∫—Ü–∏–∏
            hideAllSections();

            // –ü–æ–∫–∞–∑–∞—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—É—é —Å–µ–∫—Ü–∏—é
            const sectionMap = {
                'clients': 'clientsBlock',
                'calculator': 'calculatorBlock',
                'comparison': 'comparisonBlock',
                'history': 'historyBlock',
                'prices': 'pricesBlock',
                'discounts': 'discountsBlock'
            };

            const blockId = sectionMap[sectionName];
            if (blockId) {
                const block = document.getElementById(blockId);
                if (block) {
                    block.classList.remove('hidden');

                    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ —Å–µ–∫—Ü–∏–∏
                    initializeSection(sectionName);
                }
            }
        }

        // –°–∫—Ä—ã—Ç—å –≤—Å–µ —Å–µ–∫—Ü–∏–∏
        function hideAllSections() {
            document.getElementById('clientsBlock').classList.add('hidden');
            document.getElementById('calculatorBlock').classList.add('hidden');
            document.getElementById('comparisonBlock').classList.add('hidden');
            document.getElementById('historyBlock').classList.add('hidden');
            document.getElementById('pricesBlock').classList.add('hidden');
            document.getElementById('discountsBlock').classList.add('hidden');
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ —Å–µ–∫—Ü–∏–∏
        function initializeSection(sectionName) {
            switch(sectionName) {
                case 'clients':
                    showAllClients();
                    break;
                case 'calculator':
                    showCalculator();
                    break;
                case 'comparison':
                    showComparison();
                    break;
                case 'history':
                    // –ë—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ —Å–ª–µ–¥—É—é—â–∏—Ö –±–ª–æ–∫–∞—Ö
                    break;
                case 'prices':
                    showPricesPanel();
                    break;
                case 'discounts':
                    manageDiscounts();
                    break;
            }
        }

        // ========================================
        // –†–ê–ó–ì–†–ê–ù–ò–ß–ï–ù–ò–ï –ü–†–ê–í
        // ========================================

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –ø–æ —Ä–æ–ª–∏
        function setupInterface() {
            if (!currentUser) return;

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
            document.getElementById('userInfo').textContent =
                `${currentUser.name} (${currentUser.role})`;

            // –ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –∫–Ω–æ–ø–∫–∏ –∞–¥–º–∏–Ω–∞
            if (currentUser.role === 'admin') {
                document.getElementById('adminPricesBtn').classList.remove('hidden');
                document.getElementById('adminDiscountsBtn').classList.remove('hidden');
            } else {
                document.getElementById('adminPricesBtn').classList.add('hidden');
                document.getElementById('adminDiscountsBtn').classList.add('hidden');
            }

            // –ü–æ–∫–∞–∑–∞—Ç—å —Å–µ–∫—Ü–∏—é –∫–ª–∏–µ–Ω—Ç–æ–≤ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            showSection('clients');
        }

        // ========================================
        // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø
        // ========================================

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ localStorage
        function loadUserData() {
            // –ó–∞–≥—Ä—É–∑–∫–∞ —Ü–µ–Ω –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
            const storedPrices = localStorage.getItem('prices');
            if (storedPrices) {
                prices = JSON.parse(storedPrices);
            }

            // –ó–∞–≥—Ä—É–∑–∫–∞ —Ü–µ–Ω —Å—Ç–æ–ª–µ—à–Ω–∏—Ü
            const storedCountertopPrices = localStorage.getItem('countertopPrices');
            if (storedCountertopPrices) {
                countertopPrices = JSON.parse(storedCountertopPrices);
            }

            // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤
            const storedClients = localStorage.getItem('clients');
            if (storedClients) {
                clients = JSON.parse(storedClients);
            }

            // –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–∞—Å—á–µ—Ç–æ–≤
            const storedCalculations = localStorage.getItem('calculations');
            if (storedCalculations) {
                calculations = JSON.parse(storedCalculations);
            }

            // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–∫–∏–¥–æ–∫
            const storedDiscounts = localStorage.getItem('discounts');
            if (storedDiscounts) {
                discounts = JSON.parse(storedDiscounts);
            }

            // –ó–∞–≥—Ä—É–∑–∫–∞ —Å—á–µ—Ç—á–∏–∫–∞ —Ä–∞—Å—á–µ—Ç–æ–≤
            const storedCounter = localStorage.getItem('calculationCounter');
            if (storedCounter) {
                calculationCounter = JSON.parse(storedCounter);
            }

            console.log('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã:', {
                clients: clients.length,
                calculations: calculations.length,
                discounts: discounts.length
            });
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        function initializeApp() {
            // –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
            loadUserData();

            // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–∞—Å—á–µ—Ç–∞
            restoreCalculation();

            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
            setupInterface();

            console.log('–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ (25 –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤, 14 —Ñ–∞—Å–∞–¥–æ–≤)');
        }

        // ========================================
        // –ë–õ–û–ö 6: –ú–ê–¢–†–ò–¶–ê –°–†–ê–í–ù–ï–ù–ò–Ø –ò –°–ö–ò–î–ö–ò
        // ========================================

        let selectedFacadesForComparison = [];
        let selectedCountertopsForComparison = [];

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –º–∞—Ç—Ä–∏—Ü—ã —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
        function showComparison() {
            const container = document.getElementById('comparisonContent');

            let html = '<p class="message info">–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞—Å–∞–¥—ã –∏ —Å—Ç–æ–ª–µ—à–Ω–∏—Ü—ã –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Å—Ç–æ–∏–º–æ—Å—Ç–∏</p>';

            // –í—ã–±–æ—Ä —Ñ–∞—Å–∞–¥–æ–≤ (–¥–æ 5)
            html += '<div style="margin-bottom: 30px;">';
            html += '<h3>–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞—Å–∞–¥—ã –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è (–¥–æ 5):</h3>';
            html += '<div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">';

            config.facades.forEach(facade => {
                const checked = selectedFacadesForComparison.includes(facade.id) ? 'checked' : '';
                html += `<label style="display: flex; align-items: center;">`;
                html += `<input type="checkbox" value="${facade.id}" ${checked}
                         onchange="toggleFacadeForComparison('${facade.id}', this.checked)"
                         style="margin-right: 8px;">`;
                html += `${facade.name}`;
                html += `</label>`;
            });

            html += '</div></div>';

            // –í—ã–±–æ—Ä —Å—Ç–æ–ª–µ—à–Ω–∏—Ü
            html += '<div style="margin-bottom: 30px;">';
            html += '<h3>–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç–æ–ª–µ—à–Ω–∏—Ü—ã:</h3>';
            html += '<div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">';

            config.countertops.forEach(countertop => {
                const checked = selectedCountertopsForComparison.includes(countertop.id) ? 'checked' : '';
                html += `<label style="display: flex; align-items: center;">`;
                html += `<input type="checkbox" value="${countertop.id}" ${checked}
                         onchange="toggleCountertopForComparison('${countertop.id}', this.checked)"
                         style="margin-right: 8px;">`;
                html += `${countertop.name}`;
                html += `</label>`;
            });

            html += '</div></div>';

            // –ö–Ω–æ–ø–∫–∏
            html += '<div style="margin-bottom: 20px;">';
            html += '<button onclick="buildComparisonTable()" class="success">–ü–æ—Å—Ç—Ä–æ–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É —Å—Ä–∞–≤–Ω–µ–Ω–∏—è</button>';
            html += '<button onclick="clearComparison()" class="secondary">–û—á–∏—Å—Ç–∏—Ç—å –≤—ã–±–æ—Ä</button>';
            html += '</div>';

            // –¢–∞–±–ª–∏—Ü–∞ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
            html += '<div id="comparisonTable"></div>';

            container.innerHTML = html;
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ñ–∞—Å–∞–¥–∞
        function toggleFacadeForComparison(facadeId, checked) {
            if (checked) {
                if (selectedFacadesForComparison.length >= 5) {
                    alert('–ú–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –º–∞–∫—Å–∏–º—É–º 5 —Ñ–∞—Å–∞–¥–æ–≤');
                    showComparison();
                    return;
                }
                selectedFacadesForComparison.push(facadeId);
            } else {
                const index = selectedFacadesForComparison.indexOf(facadeId);
                if (index > -1) {
                    selectedFacadesForComparison.splice(index, 1);
                }
            }
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å—Ç–æ–ª–µ—à–Ω–∏—Ü—ã
        function toggleCountertopForComparison(countertopId, checked) {
            if (checked) {
                selectedCountertopsForComparison.push(countertopId);
            } else {
                const index = selectedCountertopsForComparison.indexOf(countertopId);
                if (index > -1) {
                    selectedCountertopsForComparison.splice(index, 1);
                }
            }
        }

        // –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
        function buildComparisonTable() {
            if (selectedFacadesForComparison.length === 0 || selectedCountertopsForComparison.length === 0) {
                alert('–í—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —Ñ–∞—Å–∞–¥ –∏ –æ–¥–Ω—É —Å—Ç–æ–ª–µ—à–Ω–∏—Ü—É');
                return;
            }

            if (!currentCalculation) {
                alert('–°–æ–∑–¥–∞–π—Ç–µ —Ä–∞—Å—á–µ—Ç, –≤—ã–±—Ä–∞–≤ –∫–ª–∏–µ–Ω—Ç–∞');
                return;
            }

            const tableDiv = document.getElementById('comparisonTable');

            let html = '<h3>–¢–∞–±–ª–∏—Ü–∞ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Å—Ç–æ–∏–º–æ—Å—Ç–∏</h3>';
            html += '<div style="overflow-x: auto;">';
            html += '<table style="min-width: 600px;">';
            html += '<thead><tr><th>–§–∞—Å–∞–¥ / –°—Ç–æ–ª–µ—à–Ω–∏—Ü–∞</th>';

            // –ó–∞–≥–æ–ª–æ–≤–∫–∏ —Å—Ç–æ–ª–µ—à–Ω–∏—Ü
            selectedCountertopsForComparison.forEach(ctId => {
                const ct = config.countertops.find(c => c.id === ctId);
                html += `<th>${ct.name}</th>`;
            });

            html += '</tr></thead><tbody>';

            // –°—Ç—Ä–æ–∫–∏ —Ñ–∞—Å–∞–¥–æ–≤
            selectedFacadesForComparison.forEach(facadeId => {
                const facade = config.facades.find(f => f.id === facadeId);
                html += `<tr><td style="font-weight: bold;">${facade.name}</td>`;

                selectedCountertopsForComparison.forEach(ctId => {
                    const price = calculateComparisonPrice(facadeId, ctId);
                    html += `<td style="text-align: right;">`;

                    if (price !== null) {
                        html += `${price.toLocaleString()} —Ä—É–±.<br>`;
                        html += `<button onclick="selectCombination('${facadeId}', '${ctId}')"
                                style="font-size: 11px; padding: 4px 8px; margin-top: 5px;">–í—ã–±—Ä–∞—Ç—å</button>`;
                    } else {
                        html += '<span style="color: #999;">–ù–µ—Ç —Ü–µ–Ω</span>';
                    }

                    html += `</td>`;
                });

                html += '</tr>';
            });

            html += '</tbody></table></div>';

            // –õ–µ–≥–µ–Ω–¥–∞
            html += '<p style="margin-top: 15px; color: #666; font-size: 12px;">';
            html += '–°—Ç–æ–∏–º–æ—Å—Ç—å —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–µ–∫—É—â–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —Ä–∞—Å—á–µ—Ç–∞';
            html += '</p>';

            tableDiv.innerHTML = html;
        }

        // –†–∞—Å—á–µ—Ç —Ü–µ–Ω—ã –¥–ª—è –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏
        function calculateComparisonPrice(facadeId, countertopId) {
            if (!currentCalculation) return null;

            const facadePrices = prices[facadeId];
            if (!facadePrices) return null;

            let total = 0;

            // –†–∞—Å—á–µ—Ç –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
            components.forEach(comp => {
                const quantity = currentCalculation.components[comp.id] || 0;
                if (quantity > 0) {
                    const price = facadePrices[comp.id] || 0;
                    total += quantity * price;
                }
            });

            // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–æ–ª–µ—à–Ω–∏—Ü—ã
            const countertop = config.countertops.find(ct => ct.id === countertopId);
            if (countertop) {
                if (countertop.type === 'auto' && currentCalculation.countertopMeters > 0) {
                    // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ü–µ–Ω—É –∏–∑ countertopPrices, –∞ –Ω–µ –∏–∑ config
                    const pricePerMeter = countertopPrices[countertop.id] || 0;
                    total += currentCalculation.countertopMeters * pricePerMeter;
                } else if (countertop.type === 'manual' && currentCalculation.countertopPrice > 0) {
                    total += currentCalculation.countertopPrice;
                }
            }

            return total > 0 ? total : null;
        }

        // –í—ã–±–æ—Ä –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏
        function selectCombination(facadeId, countertopId) {
            if (!currentCalculation) return;

            currentCalculation.selectedFacade = facadeId;
            currentCalculation.selectedCountertop = countertopId;

            const facade = config.facades.find(f => f.id === facadeId);
            const countertop = config.countertops.find(ct => ct.id === countertopId);

            alert(`–í—ã–±—Ä–∞–Ω–∞ –∫–æ–º–±–∏–Ω–∞—Ü–∏—è:\n\n–§–∞—Å–∞–¥: ${facade.name}\n–°—Ç–æ–ª–µ—à–Ω–∏—Ü–∞: ${countertop.name}\n\n–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª "–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä" –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–∞—Å—á–µ—Ç–∞`);

            autoSave();
            console.log('–í—ã–±—Ä–∞–Ω–∞ –∫–æ–º–±–∏–Ω–∞—Ü–∏—è:', facadeId, countertopId);
        }

        // –û—á–∏—Å—Ç–∫–∞ –≤—ã–±–æ—Ä–∞
        function clearComparison() {
            selectedFacadesForComparison = [];
            selectedCountertopsForComparison = [];
            showComparison();
        }

        // ========================================
        // –°–ò–°–¢–ï–ú–ê –°–ö–ò–î–û–ö
        // ========================================

        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∫–∏–¥–∫–∞–º–∏ (—Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω)
        function manageDiscounts() {
            if (currentUser.role !== 'admin') {
                document.getElementById('discountsContent').innerHTML =
                    '<p class="message error">–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω. –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å —Å–∫–∏–¥–∫–∞–º–∏.</p>';
                return;
            }

            const container = document.getElementById('discountsContent');

            let html = '<h3>–î–æ—Å—Ç—É–ø–Ω—ã–µ —Å–∫–∏–¥–∫–∏</h3>';

            // –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å–∫–∏–¥–∫–∏
            html += '<div style="margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 4px;">';
            html += '<h4 style="margin: 0 0 10px 0;">–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é —Å–∫–∏–¥–∫—É</h4>';
            html += '<div style="display: flex; gap: 10px; align-items: flex-end;">';
            html += '<div style="flex: 1;">';
            html += '<label>–ù–∞–∑–≤–∞–Ω–∏–µ:</label>';
            html += '<input type="text" id="discountName" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ü–æ—Å—Ç–æ—è–Ω–Ω—ã–π –∫–ª–∏–µ–Ω—Ç" style="width: 100%;">';
            html += '</div>';
            html += '<div style="width: 150px;">';
            html += '<label>–ü—Ä–æ—Ü–µ–Ω—Ç:</label>';
            html += '<input type="number" id="discountValue" placeholder="5" min="0" max="100" step="1" style="width: 100%;">';
            html += '</div>';
            html += '<button onclick="addDiscount()" class="success">–î–æ–±–∞–≤–∏—Ç—å</button>';
            html += '</div>';
            html += '</div>';

            // –°–ø–∏—Å–æ–∫ —Å–∫–∏–¥–æ–∫
            if (discounts.length === 0) {
                html += '<p class="message info">–°–∫–∏–¥–æ–∫ –ø–æ–∫–∞ –Ω–µ—Ç. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—É—é —Å–∫–∏–¥–∫—É.</p>';
            } else {
                html += '<table>';
                html += '<thead><tr><th>–ù–∞–∑–≤–∞–Ω–∏–µ</th><th>–ü—Ä–æ—Ü–µ–Ω—Ç</th><th>–î–µ–π—Å—Ç–≤–∏—è</th></tr></thead>';
                html += '<tbody>';

                discounts.forEach((discount, index) => {
                    html += '<tr>';
                    html += `<td>${discount.name}</td>`;
                    html += `<td>${discount.value}%</td>`;
                    html += `<td><button onclick="removeDiscount(${index})" class="danger">–£–¥–∞–ª–∏—Ç—å</button></td>`;
                    html += '</tr>';
                });

                html += '</tbody></table>';
            }

            container.innerHTML = html;
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–∫–∏–¥–∫–∏
        function addDiscount() {
            const name = document.getElementById('discountName').value.trim();
            const value = parseFloat(document.getElementById('discountValue').value);

            if (!name) {
                alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Å–∫–∏–¥–∫–∏');
                return;
            }

            if (isNaN(value) || value < 0 || value > 100) {
                alert('–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ—Ü–µ–Ω—Ç –æ—Ç 0 –¥–æ 100');
                return;
            }

            discounts.push({ name, value });
            localStorage.setItem('discounts', JSON.stringify(discounts));

            console.log('–°–∫–∏–¥–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞:', name, value);
            manageDiscounts();
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ —Å–∫–∏–¥–∫–∏
        function removeDiscount(index) {
            const discount = discounts[index];
            if (confirm(`–£–¥–∞–ª–∏—Ç—å —Å–∫–∏–¥–∫—É "${discount.name}" (${discount.value}%)?`)) {
                discounts.splice(index, 1);
                localStorage.setItem('discounts', JSON.stringify(discounts));
                console.log('–°–∫–∏–¥–∫–∞ —É–¥–∞–ª–µ–Ω–∞');
                manageDiscounts();
            }
        }

        // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Å–∫–∏–¥–∫–∏ –∫ —Ç–µ–∫—É—â–µ–º—É —Ä–∞—Å—á–µ—Ç—É
        function applyDiscountToCalculation(value) {
            if (!currentCalculation) return;

            const discountValue = parseFloat(value) || 0;
            currentCalculation.discount = discountValue;

            // –ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å –∏—Ç–æ–≥–æ–≤—É—é —Å—É–º–º—É, –µ—Å–ª–∏ —Ä–∞—Å—á–µ—Ç —É–∂–µ –≤—ã–ø–æ–ª–Ω–µ–Ω
            if (currentCalculation.subtotal > 0) {
                const discountAmount = currentCalculation.subtotal * (discountValue / 100);
                currentCalculation.discountAmount = discountAmount;
                currentCalculation.total = currentCalculation.subtotal - discountAmount;
            }

            autoSave();
            showCalculator();

            console.log('–°–∫–∏–¥–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞ –∫ —Ä–∞—Å—á–µ—Ç—É:', discountValue + '%');
        }

        // ========================================
        // –ë–õ–û–ö 3: –£–ü–†–ê–í–õ–ï–ù–ò–ï –¶–ï–ù–ê–ú–ò (–ê–î–ú–ò–ù)
        // ========================================

        let currentFacadeForPrices = null;

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–∞–Ω–µ–ª–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ü–µ–Ω–∞–º–∏
        function showPricesPanel() {
            const container = document.getElementById('pricesContent');

            let html = '';

            // –¶–µ–Ω—ã –Ω–∞ —Å—Ç–æ–ª–µ—à–Ω–∏—Ü—ã –õ–î–°–ü
            html += '<div style="margin-bottom: 30px; padding: 20px; background: #f8f9fa; border-radius: 4px;">';
            html += '<h3 style="margin: 0 0 15px 0;">–¶–µ–Ω—ã –Ω–∞ —Å—Ç–æ–ª–µ—à–Ω–∏—Ü—ã –õ–î–°–ü (–∑–∞ –ø.–º.)</h3>';
            html += '<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">';

            // –õ–î–°–ü 28–º–º
            const ldsp28Price = countertopPrices['ldsp_28'] || 0;
            html += '<div>';
            html += '<label style="font-weight: bold; display: block; margin-bottom: 5px;">–õ–î–°–ü 28–º–º (—Ä—É–±./–ø.–º.):</label>';
            html += '<input type="number" id="countertop_ldsp_28" value="' + ldsp28Price + '" ';
            html += 'style="width: 200px;" step="0.01" min="0" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ü–µ–Ω—É">';
            html += '<span id="display_ldsp_28" style="margin-left: 10px; color: ' + (ldsp28Price > 0 ? '#007bff' : '#999') + '; font-weight: bold;">';
            html += ldsp28Price > 0 ? ldsp28Price.toLocaleString() + ' —Ä—É–±./–ø.–º.' : '–ù–µ —É–∫–∞–∑–∞–Ω–æ';
            html += '</span>';
            html += '</div>';

            // –õ–î–°–ü 40–º–º
            const ldsp40Price = countertopPrices['ldsp_40'] || 0;
            html += '<div>';
            html += '<label style="font-weight: bold; display: block; margin-bottom: 5px;">–õ–î–°–ü 40–º–º (—Ä—É–±./–ø.–º.):</label>';
            html += '<input type="number" id="countertop_ldsp_40" value="' + ldsp40Price + '" ';
            html += 'style="width: 200px;" step="0.01" min="0" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ü–µ–Ω—É">';
            html += '<span id="display_ldsp_40" style="margin-left: 10px; color: ' + (ldsp40Price > 0 ? '#007bff' : '#999') + '; font-weight: bold;">';
            html += ldsp40Price > 0 ? ldsp40Price.toLocaleString() + ' —Ä—É–±./–ø.–º.' : '–ù–µ —É–∫–∞–∑–∞–Ω–æ';
            html += '</span>';
            html += '</div>';

            html += '</div>';
            html += '<p style="margin-top: 10px; color: #666; font-size: 12px;">–°—Ç–æ–ª–µ—à–Ω–∏—Ü—ã "–ê–∫—Ä–∏–ª" –∏ "–ö–≤–∞—Ä—Ü" –≤–≤–æ–¥—è—Ç—Å—è –≤—Ä—É—á–Ω—É—é –ø—Ä–∏ —Ä–∞—Å—á–µ—Ç–µ.</p>';
            html += '</div>';

            // –í—ã–±–æ—Ä —Ñ–∞—Å–∞–¥–∞
            html += '<div style="margin-bottom: 20px;">';
            html += '<label style="font-weight: bold; display: block; margin-bottom: 10px;">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø —Ñ–∞—Å–∞–¥–∞ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ü–µ–Ω –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:</label>';
            html += '<select id="facadeSelector" onchange="loadPricesForFacade(this.value)" style="width: 300px;">';
            html += '<option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞—Å–∞–¥ --</option>';

            config.facades.forEach(facade => {
                const selected = currentFacadeForPrices === facade.id ? 'selected' : '';
                html += `<option value="${facade.id}" ${selected}>${facade.name}</option>`;
            });

            html += '</select>';
            html += '</div>';

            // –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
            html += '<div style="margin-bottom: 20px;">';
            html += '<button onclick="savePrices()" class="success">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—Å–µ —Ü–µ–Ω—ã</button>';
            html += '<button onclick="exportPrices()" class="secondary">–≠–∫—Å–ø–æ—Ä—Ç –≤ JSON</button>';
            html += '<button onclick="document.getElementById(\'importPricesFile\').click()" class="secondary">–ò–º–ø–æ—Ä—Ç –∏–∑ JSON</button>';
            html += '<input type="file" id="importPricesFile" accept=".json" style="display:none;" onchange="importPrices(event)">';
            html += '</div>';

            // –¢–∞–±–ª–∏—Ü–∞ —Ü–µ–Ω
            html += '<div id="pricesTable"></div>';

            container.innerHTML = html;

            // –ü—Ä–æ–≥—Ä–∞–º–º–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –¥–ª—è —Å—Ç–æ–ª–µ—à–Ω–∏—Ü
            console.log('üöÄ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ event listeners –¥–ª—è —Å—Ç–æ–ª–µ—à–Ω–∏—Ü...');

            const ldsp28Input = document.getElementById('countertop_ldsp_28');
            const ldsp40Input = document.getElementById('countertop_ldsp_40');

            if (ldsp28Input) {
                console.log('‚úÖ –ù–∞–π–¥–µ–Ω–æ –ø–æ–ª–µ countertop_ldsp_28');
                ldsp28Input.addEventListener('input', function(e) {
                    console.log('‚ö° EVENT: input –Ω–∞ ldsp_28, –∑–Ω–∞—á–µ–Ω–∏–µ:', e.target.value);
                    console.log('üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ—É–Ω–∫—Ü–∏–∏:', typeof updateCountertopPrice);
                    try {
                        updateCountertopPrice('ldsp_28', e.target.value);
                    } catch (error) {
                        console.error('üí• –û–®–ò–ë–ö–ê –ø—Ä–∏ –≤—ã–∑–æ–≤–µ updateCountertopPrice:', error);
                    }
                });
                ldsp28Input.addEventListener('blur', function(e) {
                    console.log('‚ö° EVENT: blur –Ω–∞ ldsp_28, –∑–Ω–∞—á–µ–Ω–∏–µ:', e.target.value);
                    try {
                        updateCountertopPrice('ldsp_28', e.target.value);
                    } catch (error) {
                        console.error('üí• –û–®–ò–ë–ö–ê –ø—Ä–∏ –≤—ã–∑–æ–≤–µ updateCountertopPrice:', error);
                    }
                });
            } else {
                console.error('‚ùå –ù–ï –Ω–∞–π–¥–µ–Ω–æ –ø–æ–ª–µ countertop_ldsp_28!');
            }

            if (ldsp40Input) {
                console.log('‚úÖ –ù–∞–π–¥–µ–Ω–æ –ø–æ–ª–µ countertop_ldsp_40');
                ldsp40Input.addEventListener('input', function(e) {
                    console.log('‚ö° EVENT: input –Ω–∞ ldsp_40, –∑–Ω–∞—á–µ–Ω–∏–µ:', e.target.value);
                    console.log('üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ—É–Ω–∫—Ü–∏–∏:', typeof updateCountertopPrice);
                    try {
                        updateCountertopPrice('ldsp_40', e.target.value);
                    } catch (error) {
                        console.error('üí• –û–®–ò–ë–ö–ê –ø—Ä–∏ –≤—ã–∑–æ–≤–µ updateCountertopPrice:', error);
                    }
                });
                ldsp40Input.addEventListener('blur', function(e) {
                    console.log('‚ö° EVENT: blur –Ω–∞ ldsp_40, –∑–Ω–∞—á–µ–Ω–∏–µ:', e.target.value);
                    try {
                        updateCountertopPrice('ldsp_40', e.target.value);
                    } catch (error) {
                        console.error('üí• –û–®–ò–ë–ö–ê –ø—Ä–∏ –≤—ã–∑–æ–≤–µ updateCountertopPrice:', error);
                    }
                });
            } else {
                console.error('‚ùå –ù–ï –Ω–∞–π–¥–µ–Ω–æ –ø–æ–ª–µ countertop_ldsp_40!');
            }

            console.log('‚ú® Event listeners –¥–æ–±–∞–≤–ª–µ–Ω—ã!');

            // –ï—Å–ª–∏ —É–∂–µ –≤—ã–±—Ä–∞–Ω —Ñ–∞—Å–∞–¥, –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ü–µ–Ω—ã
            if (currentFacadeForPrices) {
                loadPricesForFacade(currentFacadeForPrices);
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ü–µ–Ω –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ñ–∞—Å–∞–¥–∞
        function loadPricesForFacade(facadeId) {
            if (!facadeId) {
                document.getElementById('pricesTable').innerHTML = '';
                currentFacadeForPrices = null;
                return;
            }

            currentFacadeForPrices = facadeId;

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ü–µ–Ω –¥–ª—è —Ñ–∞—Å–∞–¥–∞, –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç
            if (!prices[facadeId]) {
                prices[facadeId] = {};
            }

            // –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã
            let html = '<table>';
            html += '<thead><tr>';
            html += '<th style="width: 50px;">ID</th>';
            html += '<th>–ö–æ–º–ø–æ–Ω–µ–Ω—Ç</th>';
            html += '<th style="width: 100px;">–ï–¥–∏–Ω–∏—Ü–∞</th>';
            html += '<th style="width: 150px;">–¶–µ–Ω–∞ –∑–∞ –µ–¥–∏–Ω–∏—Ü—É</th>';
            html += '<th style="width: 120px;">–¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞</th>';
            html += '</tr></thead>';
            html += '<tbody>';

            components.forEach(component => {
                const currentPrice = prices[facadeId][component.id] || 0;
                const priceDisplay = currentPrice !== 0 ? currentPrice.toLocaleString() + ' —Ä—É–±.' : '-';
                const isDiscount = component.isDiscount;

                html += '<tr>';
                html += `<td>${component.id}</td>`;
                html += `<td>${component.name}${isDiscount ? ' <span style="color: red;">(—Å–∫–∏–¥–∫–∞)</span>' : ''}</td>`;
                html += `<td>${component.unit}</td>`;
                html += `<td><input type="number" id="price_${component.id}" value="${currentPrice}"
                         onchange="updatePrice('${facadeId}', ${component.id}, this.value)"
                         style="width: 130px;" step="0.01"></td>`;
                html += `<td style="font-weight: bold; color: ${currentPrice < 0 ? 'red' : '#007bff'};">${priceDisplay}</td>`;
                html += '</tr>';
            });

            html += '</tbody></table>';

            document.getElementById('pricesTable').innerHTML = html;
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω—ã –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
        function updatePrice(facadeId, componentId, value) {
            const price = parseFloat(value) || 0;

            if (!prices[facadeId]) {
                prices[facadeId] = {};
            }

            prices[facadeId][componentId] = price;

            // –û–±–Ω–æ–≤–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–π —Ü–µ–Ω—ã
            const currentPriceCell = document.querySelector(`#price_${componentId}`).closest('tr').cells[4];
            const priceDisplay = price !== 0 ? price.toLocaleString() + ' —Ä—É–±.' : '-';
            currentPriceCell.innerHTML = priceDisplay;
            currentPriceCell.style.color = price < 0 ? 'red' : '#007bff';

            console.log(`–¶–µ–Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞: —Ñ–∞—Å–∞–¥ ${facadeId}, –∫–æ–º–ø–æ–Ω–µ–Ω—Ç ${componentId}, —Ü–µ–Ω–∞ ${price}`);
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω—ã —Å—Ç–æ–ª–µ—à–Ω–∏—Ü—ã –≤ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∏
        function updateCountertopPrice(countertopId, value) {
            console.log('========================================');
            console.log('üîµ updateCountertopPrice –í–´–ó–í–ê–ù–ê!');
            console.log('ID:', countertopId);
            console.log('Value:', value);
            console.log('========================================');

            const price = parseFloat(value) || 0;
            console.log('üìä –¶–µ–Ω–∞ –ø–æ—Å–ª–µ parseFloat:', price);

            countertopPrices[countertopId] = price;
            console.log('üíæ countertopPrices –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:', JSON.stringify(countertopPrices));

            try {
                localStorage.setItem('countertopPrices', JSON.stringify(countertopPrices));
                console.log('‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ localStorage');

                // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
                const saved = localStorage.getItem('countertopPrices');
                console.log('üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ localStorage.getItem:', saved);
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ localStorage:', error);
            }

            // –û–±–Ω–æ–≤–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            const displaySpan = document.getElementById('display_' + countertopId);
            if (displaySpan) {
                displaySpan.textContent = price > 0 ? price.toLocaleString() + ' —Ä—É–±./–ø.–º.' : '–ù–µ —É–∫–∞–∑–∞–Ω–æ';
                displaySpan.style.color = price > 0 ? '#007bff' : '#999';
                console.log('üé® –û–±–Ω–æ–≤–ª–µ–Ω span, –Ω–æ–≤—ã–π —Ü–≤–µ—Ç:', displaySpan.style.color);
            } else {
                console.warn('‚ö†Ô∏è –≠–ª–µ–º–µ–Ω—Ç display_' + countertopId + ' –Ω–µ –Ω–∞–π–¥–µ–Ω!');
            }

            console.log('‚ú® updateCountertopPrice –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
            console.log('========================================');
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ—É–Ω–∫—Ü–∏–∏
        console.log('üìå –§—É–Ω–∫—Ü–∏—è updateCountertopPrice –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞:', typeof updateCountertopPrice);

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö —Ü–µ–Ω –≤ localStorage
        function savePrices() {
            try {
                localStorage.setItem('prices', JSON.stringify(prices));
                localStorage.setItem('countertopPrices', JSON.stringify(countertopPrices));

                // –ü–æ–¥—Å—á–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö —Ü–µ–Ω
                let totalPrices = 0;
                Object.keys(prices).forEach(facadeId => {
                    Object.keys(prices[facadeId]).forEach(componentId => {
                        if (prices[facadeId][componentId] !== 0) {
                            totalPrices++;
                        }
                    });
                });

                const countertopCount = Object.keys(countertopPrices).filter(k => countertopPrices[k] > 0).length;

                alert(`–¶–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!\n\n–¶–µ–Ω –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤: ${totalPrices}\n–¶–µ–Ω —Å—Ç–æ–ª–µ—à–Ω–∏—Ü: ${countertopCount}`);
                console.log('–¶–µ–Ω—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ localStorage');
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Ü–µ–Ω: ' + error.message);
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', error);
            }
        }

        // –≠–∫—Å–ø–æ—Ä—Ç —Ü–µ–Ω –≤ JSON —Ñ–∞–π–ª
        function exportPrices() {
            try {
                const exportData = {
                    exportDate: new Date().toISOString(),
                    facades: config.facades.length,
                    components: components.length,
                    prices: prices,
                    countertopPrices: countertopPrices
                };

                const dataStr = JSON.stringify(exportData, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);

                const fileName = `prices_${new Date().toISOString().split('T')[0]}.json`;

                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', fileName);
                linkElement.click();

                console.log('–¶–µ–Ω—ã —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ —Ñ–∞–π–ª:', fileName);
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ —Ü–µ–Ω: ' + error.message);
                console.error('–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞:', error);
            }
        }

        // –ò–º–ø–æ—Ä—Ç —Ü–µ–Ω –∏–∑ JSON —Ñ–∞–π–ª–∞
        function importPrices(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importData = JSON.parse(e.target.result);

                    // –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
                    if (!importData.prices || typeof importData.prices !== 'object') {
                        throw new Error('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –æ–±—ä–µ–∫—Ç prices');
                    }

                    // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∏–º–ø–æ—Ä—Ç–∞
                    const confirm = window.confirm(
                        `–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Ü–µ–Ω—ã?\n\n` +
                        `–î–∞—Ç–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞: ${importData.exportDate || '–Ω–µ —É–∫–∞–∑–∞–Ω–∞'}\n` +
                        `–§–∞—Å–∞–¥–æ–≤: ${importData.facades || '?'}\n` +
                        `–ö–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤: ${importData.components || '?'}\n\n` +
                        `–¢–µ–∫—É—â–∏–µ —Ü–µ–Ω—ã –±—É–¥—É—Ç –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞–Ω—ã!`
                    );

                    if (confirm) {
                        prices = importData.prices;

                        // –ò–º–ø–æ—Ä—Ç —Ü–µ–Ω —Å—Ç–æ–ª–µ—à–Ω–∏—Ü (–µ—Å–ª–∏ –µ—Å—Ç—å –≤ —Ñ–∞–π–ª–µ)
                        if (importData.countertopPrices) {
                            countertopPrices = importData.countertopPrices;
                        }

                        savePrices();

                        // –û–±–Ω–æ–≤–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                        showPricesPanel();

                        alert('–¶–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã!');
                        console.log('–¶–µ–Ω—ã –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –∏–∑ —Ñ–∞–π–ª–∞');
                    }
                } catch (error) {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ —Ü–µ–Ω: ' + error.message);
                    console.error('–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞:', error);
                }
            };
            reader.readAsText(file);

            // –û—á–∏—Å—Ç–∏—Ç—å input –¥–ª—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞ —Ç–æ–≥–æ –∂–µ —Ñ–∞–π–ª–∞
            event.target.value = '';
        }

        // ========================================
        // –ë–õ–û–ö 5: –ö–ê–õ–¨–ö–£–õ–Ø–¢–û–† –ö–û–ú–ü–û–ù–ï–ù–¢–û–í
        // ========================================

        // –ö–ª–∞—Å—Å —Ä–∞—Å—á–µ—Ç–∞
        class Calculation {
            constructor(clientId, number) {
                this.id = Date.now().toString() + Math.random().toString(36).substr(2, 9);
                this.number = number;
                this.clientId = clientId;
                this.date = new Date().toISOString();
                this.components = {};
                this.selectedFacade = null;
                this.selectedCountertop = null;
                this.countertopPrice = 0;
                this.countertopMeters = 0;
                this.discount = 0;
                this.subtotal = 0;
                this.discountAmount = 0;
                this.total = 0;
                this.details = [];
                this.status = 'draft';
                this.author = currentUser.username;
                this.createdAt = new Date().toISOString();
                this.savedAt = null;
            }
        }

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–æ–º–µ—Ä–∞ —Ä–∞—Å—á–µ—Ç–∞ (–î–î–ú–ú-NNN-–ö–û–î)
        function generateCalculationNumber() {
            const now = new Date();
            const day = String(now.getDate()).padStart(2, '0');
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const dateKey = `${day}${month}`;

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—á–µ—Ç—á–∏–∫–∞ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –¥–Ω—è
            if (!calculationCounter[dateKey]) {
                calculationCounter[dateKey] = 0;
            }

            calculationCounter[dateKey]++;
            const counter = String(calculationCounter[dateKey]).padStart(3, '0');

            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞
            localStorage.setItem('calculationCounter', JSON.stringify(calculationCounter));

            return `${dateKey}-${counter}-${currentUser.code}`;
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞
        function createNewCalculation(clientId) {
            const number = generateCalculationNumber();
            currentCalculation = new Calculation(clientId, number);
            console.log('–ù–æ–≤—ã–π —Ä–∞—Å—á–µ—Ç —Å–æ–∑–¥–∞–Ω:', currentCalculation.number);
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
        function showCalculator() {
            const container = document.getElementById('calculatorContent');

            if (!currentCalculation) {
                container.innerHTML = '<p class="message info">–í—ã–±–µ—Ä–∏—Ç–µ –∫–ª–∏–µ–Ω—Ç–∞ –≤ —Ä–∞–∑–¥–µ–ª–µ "–ö–ª–∏–µ–Ω—Ç—ã" –¥–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞—Å—á–µ—Ç–∞</p>';
                return;
            }

            const client = clients.find(c => c.id === currentCalculation.clientId);
            const clientName = client ? `${client.lastName} ${client.firstName}` : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π';

            let html = '<div class="result-summary" style="background: #e3f2fd; margin-bottom: 20px;">';
            html += `<h3 style="margin: 0 0 10px 0;">–†–∞—Å—á–µ—Ç ‚Ññ ${currentCalculation.number}</h3>`;
            html += `<div><strong>–ö–ª–∏–µ–Ω—Ç:</strong> ${clientName}</div>`;
            html += `<div><strong>–î–∞—Ç–∞:</strong> ${new Date(currentCalculation.date).toLocaleString('ru-RU')}</div>`;
            html += '</div>';

            // –í—ã–±–æ—Ä —Ñ–∞—Å–∞–¥–∞
            html += '<div style="margin-bottom: 20px;">';
            html += '<label style="font-weight: bold; display: block; margin-bottom: 5px;">–¢–∏–ø —Ñ–∞—Å–∞–¥–∞:</label>';
            html += '<select id="facadeSelect" onchange="selectFacade(this.value)" style="width: 300px;">';
            html += '<option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞—Å–∞–¥ --</option>';

            config.facades.forEach(facade => {
                const selected = currentCalculation.selectedFacade === facade.id ? 'selected' : '';
                html += `<option value="${facade.id}" ${selected}>${facade.name}</option>`;
            });

            html += '</select>';
            html += '</div>';

            // –í—ã–±–æ—Ä —Å–∫–∏–¥–∫–∏
            if (discounts.length > 0) {
                html += '<div style="margin-bottom: 20px;">';
                html += '<label style="font-weight: bold; display: block; margin-bottom: 5px;">–°–∫–∏–¥–∫–∞:</label>';
                html += '<select id="discountSelect" onchange="applyDiscountToCalculation(this.value)" style="width: 300px;">';
                html += '<option value="0">–ë–µ–∑ —Å–∫–∏–¥–∫–∏</option>';

                discounts.forEach(discount => {
                    const selected = currentCalculation.discount === discount.value ? 'selected' : '';
                    html += `<option value="${discount.value}" ${selected}>${discount.name} (-${discount.value}%)</option>`;
                });

                html += '</select>';
                html += '</div>';
            }

            // –í—ã–±–æ—Ä —Å—Ç–æ–ª–µ—à–Ω–∏—Ü—ã
            html += '<div style="margin-bottom: 20px;">';
            html += '<label style="font-weight: bold; display: block; margin-bottom: 5px;">–°—Ç–æ–ª–µ—à–Ω–∏—Ü–∞:</label>';
            html += '<select id="countertopSelect" onchange="selectCountertop(this.value)" style="width: 300px;">';
            html += '<option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç–æ–ª–µ—à–Ω–∏—Ü—É --</option>';

            config.countertops.forEach(countertop => {
                const selected = currentCalculation.selectedCountertop === countertop.id ? 'selected' : '';
                html += `<option value="${countertop.id}" ${selected}>${countertop.name}</option>`;
            });

            html += '</select>';

            // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –¥–ª—è —Å—Ç–æ–ª–µ—à–Ω–∏—Ü—ã
            const selectedCountertop = config.countertops.find(ct => ct.id === currentCalculation.selectedCountertop);
            if (selectedCountertop) {
                if (selectedCountertop.type === 'auto') {
                    html += '<div style="margin-top: 10px;">';
                    html += '<label>–ü–æ–≥–æ–Ω–Ω—ã–µ –º–µ—Ç—Ä—ã:</label> ';
                    html += `<input type="number" id="countertopMeters" value="${currentCalculation.countertopMeters || 0}"
                             onchange="updateCountertopMeters(this.value)" step="0.1" min="0" style="width: 100px;">`;
                    html += '</div>';
                } else if (selectedCountertop.type === 'manual') {
                    html += '<div style="margin-top: 10px;">';
                    html += '<label>–°—Ç–æ–∏–º–æ—Å—Ç—å (—Ä—É–±.):</label> ';
                    html += `<input type="number" id="countertopPrice" value="${currentCalculation.countertopPrice || 0}"
                             onchange="updateCountertopPriceInCalculation(this.value)" min="0" style="width: 150px;">`;
                    html += '</div>';
                }
            }

            html += '</div>';

            // –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
            if (currentCalculation.selectedFacade) {
                html += '<h3>–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∫—É—Ö–Ω–∏</h3>';

                // –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
                const grouped = {};
                components.forEach(comp => {
                    if (!grouped[comp.category]) {
                        grouped[comp.category] = [];
                    }
                    grouped[comp.category].push(comp);
                });

                Object.keys(grouped).forEach(category => {
                    html += `<div class="component-group">`;
                    html += `<h4 style="margin: 10px 0; color: #007bff;">${category}</h4>`;

                    grouped[category].forEach(comp => {
                        const quantity = currentCalculation.components[comp.id] || 0;
                        const step = comp.unit === '–ø.–º.' ? '0.1' : '1';
                        const facadePrice = prices[currentCalculation.selectedFacade]?.[comp.id] || 0;
                        const lineTotal = quantity * facadePrice;

                        html += '<div class="component-row">';
                        html += `<label>${comp.name} (${comp.unit})</label>`;
                        html += `<input type="number" value="${quantity}"
                                 onchange="updateComponent(${comp.id}, this.value)"
                                 step="${step}" min="0" style="width: 100px;">`;
                        html += `<span style="min-width: 100px; text-align: right; color: #666;">@ ${facadePrice.toLocaleString()} —Ä—É–±.</span>`;
                        html += `<span class="price">${lineTotal.toLocaleString()} —Ä—É–±.</span>`;
                        html += '</div>';
                    });

                    html += '</div>';
                });

                // –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
                html += '<div style="margin-top: 30px; padding-top: 20px; border-top: 2px solid #ddd;">';
                html += '<button onclick="calculateTotal()" class="success">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å</button>';
                html += '<button onclick="clearCalculation()" class="secondary">–û—á–∏—Å—Ç–∏—Ç—å —Ä–∞—Å—á–µ—Ç</button>';
                html += '<button onclick="showSection(\'clients\')" class="secondary">–í—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞</button>';
                html += '</div>';

                // –†–µ–∑—É–ª—å—Ç–∞—Ç—ã
                if (currentCalculation.total > 0) {
                    html += '<div class="result-summary" style="margin-top: 20px;">';
                    html += `<div><strong>–ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–π –∏—Ç–æ–≥:</strong> ${currentCalculation.subtotal.toLocaleString()} —Ä—É–±.</div>`;

                    if (currentCalculation.discount > 0) {
                        html += `<div style="color: #dc3545;"><strong>–°–∫–∏–¥–∫–∞ (${currentCalculation.discount}%):</strong> -${currentCalculation.discountAmount.toLocaleString()} —Ä—É–±.</div>`;
                    }

                    html += `<div class="total">–ò–¢–û–ì–û: ${currentCalculation.total.toLocaleString()} —Ä—É–±.</div>`;
                    html += '<div style="margin-top: 15px;">';
                    html += '<button onclick="saveCurrentCalculation()" class="success">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–∞—Å—á–µ—Ç</button>';
                    html += '</div>';
                    html += '</div>';
                }
            } else {
                html += '<p class="message info">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø —Ñ–∞—Å–∞–¥–∞ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤</p>';
            }

            container.innerHTML = html;
        }

        // –í—ã–±–æ—Ä —Ñ–∞—Å–∞–¥–∞
        function selectFacade(facadeId) {
            if (!currentCalculation) return;
            currentCalculation.selectedFacade = facadeId;
            autoSave();
            showCalculator();
        }

        // –í—ã–±–æ—Ä —Å—Ç–æ–ª–µ—à–Ω–∏—Ü—ã
        function selectCountertop(countertopId) {
            if (!currentCalculation) return;
            currentCalculation.selectedCountertop = countertopId;
            currentCalculation.countertopPrice = 0;
            currentCalculation.countertopMeters = 0;
            autoSave();
            showCalculator();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ—Ç—Ä–∞–∂–∞ —Å—Ç–æ–ª–µ—à–Ω–∏—Ü—ã
        function updateCountertopMeters(value) {
            if (!currentCalculation) return;
            currentCalculation.countertopMeters = parseFloat(value) || 0;
            autoSave();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω—ã —Å—Ç–æ–ª–µ—à–Ω–∏—Ü—ã –≤ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–µ (—Ä—É—á–Ω–æ–π –≤–≤–æ–¥ –¥–ª—è –ê–∫—Ä–∏–ª/–ö–≤–∞—Ä—Ü)
        function updateCountertopPriceInCalculation(value) {
            if (!currentCalculation) return;
            currentCalculation.countertopPrice = parseFloat(value) || 0;
            autoSave();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
        function updateComponent(componentId, value) {
            if (!currentCalculation) return;
            currentCalculation.components[componentId] = parseFloat(value) || 0;
            autoSave();
            showCalculator();
        }

        // –†–∞—Å—á–µ—Ç –∏—Ç–æ–≥–æ–≤–æ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏
        function calculateTotal() {
            if (!currentCalculation || !currentCalculation.selectedFacade) {
                alert('–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø —Ñ–∞—Å–∞–¥–∞');
                return;
            }

            let subtotal = 0;
            const details = [];

            // –†–∞—Å—á–µ—Ç –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
            const facadePrices = prices[currentCalculation.selectedFacade] || {};

            components.forEach(comp => {
                const quantity = currentCalculation.components[comp.id] || 0;
                if (quantity > 0) {
                    const price = facadePrices[comp.id] || 0;
                    const lineTotal = quantity * price;

                    subtotal += lineTotal;
                    details.push({
                        component: comp.name,
                        quantity: quantity,
                        unit: comp.unit,
                        price: price,
                        total: lineTotal
                    });
                }
            });

            // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–æ–ª–µ—à–Ω–∏—Ü—ã
            if (currentCalculation.selectedCountertop) {
                const countertop = config.countertops.find(ct => ct.id === currentCalculation.selectedCountertop);
                if (countertop) {
                    let countertopTotal = 0;
                    let countertopPricePerMeter = 0;

                    console.log('=== –†–ê–°–ß–ï–¢ –°–¢–û–õ–ï–®–ù–ò–¶–´ ===');
                    console.log('ID —Å—Ç–æ–ª–µ—à–Ω–∏—Ü—ã:', countertop.id);
                    console.log('–¢–∏–ø —Å—Ç–æ–ª–µ—à–Ω–∏—Ü—ã:', countertop.type);
                    console.log('–ú–µ—Ç—Ä–æ–≤:', currentCalculation.countertopMeters);

                    if (countertop.type === 'auto' && currentCalculation.countertopMeters > 0) {
                        // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ü–µ–Ω—É –∏–∑ countertopPrices, –∞ –Ω–µ –∏–∑ config
                        countertopPricePerMeter = countertopPrices[countertop.id] || 0;
                        countertopTotal = currentCalculation.countertopMeters * countertopPricePerMeter;

                        console.log('–¶–µ–Ω–∞ –∑–∞ –ø.–º. (–∏–∑ countertopPrices):', countertopPricePerMeter);
                        console.log('–í—Å–µ —Ü–µ–Ω—ã —Å—Ç–æ–ª–µ—à–Ω–∏—Ü:', countertopPrices);
                        console.log('–ò—Ç–æ–≥–æ —Å—Ç–æ–ª–µ—à–Ω–∏—Ü–∞:', countertopTotal);
                    } else if (countertop.type === 'manual') {
                        countertopTotal = currentCalculation.countertopPrice || 0;
                        console.log('–†—É—á–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å:', countertopTotal);
                    }

                    if (countertopTotal > 0) {
                        subtotal += countertopTotal;
                        details.push({
                            component: `–°—Ç–æ–ª–µ—à–Ω–∏—Ü–∞: ${countertop.name}`,
                            quantity: countertop.type === 'auto' ? currentCalculation.countertopMeters : 1,
                            unit: countertop.type === 'auto' ? '–ø.–º.' : '—à—Ç.',
                            price: countertop.type === 'auto' ? countertopPricePerMeter : countertopTotal,
                            total: countertopTotal
                        });
                    } else {
                        console.warn('‚ö†Ô∏è –°—Ç–æ–∏–º–æ—Å—Ç—å —Å—Ç–æ–ª–µ—à–Ω–∏—Ü—ã = 0! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ü–µ–Ω—ã –≤ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∏.');
                    }
                }
            }

            // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Å–∫–∏–¥–∫–∏
            const discountAmount = subtotal * (currentCalculation.discount / 100);
            const total = subtotal - discountAmount;

            currentCalculation.subtotal = subtotal;
            currentCalculation.discountAmount = discountAmount;
            currentCalculation.total = total;
            currentCalculation.details = details;

            autoSave();
            showCalculator();

            console.log('–†–∞—Å—á–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω:', {
                subtotal: subtotal,
                discount: currentCalculation.discount,
                discountAmount: discountAmount,
                total: total
            });
        }

        // –û—á–∏—Å—Ç–∫–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —Ä–∞—Å—á–µ—Ç–∞
        function clearCalculation() {
            if (!currentCalculation) return;

            if (confirm('–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ä–∞—Å—á–µ—Ç–∞?')) {
                currentCalculation.components = {};
                currentCalculation.countertopMeters = 0;
                currentCalculation.countertopPrice = 0;
                currentCalculation.subtotal = 0;
                currentCalculation.discountAmount = 0;
                currentCalculation.total = 0;
                currentCalculation.details = [];
                autoSave();
                showCalculator();
            }
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ —Ä–∞—Å—á–µ—Ç–∞
        function saveCurrentCalculation() {
            if (!currentCalculation) return;

            if (currentCalculation.total === 0) {
                alert('–í—ã–ø–æ–ª–Ω–∏—Ç–µ —Ä–∞—Å—á–µ—Ç –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º');
                return;
            }

            currentCalculation.status = 'completed';
            currentCalculation.savedAt = new Date().toISOString();

            // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫ —Ä–∞—Å—á–µ—Ç–∞–º
            calculations.push(currentCalculation);
            localStorage.setItem('calculations', JSON.stringify(calculations));

            // –ü—Ä–∏–≤—è–∑–∫–∞ –∫ –∫–ª–∏–µ–Ω—Ç—É
            const client = clients.find(c => c.id === currentCalculation.clientId);
            if (client) {
                if (!client.calculations.includes(currentCalculation.number)) {
                    client.calculations.push(currentCalculation.number);
                    saveClients();
                }
            }

            alert(`–†–∞—Å—á–µ—Ç ${currentCalculation.number} —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω!\n\n–ò—Ç–æ–≥–æ: ${currentCalculation.total.toLocaleString()} —Ä—É–±.`);
            console.log('–†–∞—Å—á–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω:', currentCalculation.number);

            // –û—á–∏—Å—Ç–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ —Ä–∞—Å—á–µ—Ç–∞
            currentCalculation = null;
            localStorage.removeItem('currentCalculation');

            showSection('clients');
        }

        // –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ —Ä–∞—Å—á–µ—Ç–∞
        function autoSave() {
            if (currentCalculation) {
                localStorage.setItem('currentCalculation', JSON.stringify(currentCalculation));
            }
        }

        // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–∞—Å—á–µ—Ç–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        function restoreCalculation() {
            const saved = localStorage.getItem('currentCalculation');
            if (saved) {
                currentCalculation = JSON.parse(saved);
                console.log('–†–∞—Å—á–µ—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏–∑ –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è');
            }
        }

        // ========================================
        // –ë–õ–û–ö 4: –£–ü–†–ê–í–õ–ï–ù–ò–ï –ö–õ–ò–ï–ù–¢–ê–ú–ò
        // ========================================

        let editingClientId = null;

        // –ö–ª–∞—Å—Å –∫–ª–∏–µ–Ω—Ç–∞
        class Client {
            constructor(lastName, firstName, middleName = '', phone = '', email = '', address = '') {
                this.id = Date.now().toString() + Math.random().toString(36).substr(2, 9);
                this.lastName = lastName;
                this.firstName = firstName;
                this.middleName = middleName;
                this.phone = phone;
                this.email = email;
                this.address = address;
                this.createdAt = new Date().toISOString();
                this.calculations = [];
            }
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ñ–æ—Ä–º—ã –∫–ª–∏–µ–Ω—Ç–∞
        document.getElementById('clientFormElement').addEventListener('submit', function(e) {
            e.preventDefault();
            saveClientForm();
        });

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞ –∏–∑ —Ñ–æ—Ä–º—ã
        function saveClientForm() {
            const lastName = document.getElementById('clientLastName').value.trim();
            const firstName = document.getElementById('clientFirstName').value.trim();
            const middleName = document.getElementById('clientMiddleName').value.trim();
            const phone = document.getElementById('clientPhone').value.trim();
            const email = document.getElementById('clientEmail').value.trim();
            const address = document.getElementById('clientAddress').value.trim();

            if (!lastName || !firstName) {
                alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è: –§–∞–º–∏–ª–∏—è –∏ –ò–º—è');
                return;
            }

            if (editingClientId) {
                // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞
                const client = clients.find(c => c.id === editingClientId);
                if (client) {
                    client.lastName = lastName;
                    client.firstName = firstName;
                    client.middleName = middleName;
                    client.phone = phone;
                    client.email = email;
                    client.address = address;
                    console.log('–ö–ª–∏–µ–Ω—Ç –æ–±–Ω–æ–≤–ª–µ–Ω:', client.id);
                }
            } else {
                // –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞
                const newClient = new Client(lastName, firstName, middleName, phone, email, address);
                clients.push(newClient);
                console.log('–ù–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω:', newClient.id);
            }

            saveClients();
            hideClientForm();
            showAllClients();
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞ (–ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ)
        function createClient(data) {
            const newClient = new Client(
                data.lastName,
                data.firstName,
                data.middleName || '',
                data.phone || '',
                data.email || '',
                data.address || ''
            );
            clients.push(newClient);
            saveClients();
            return newClient;
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞
        function updateClient(id, data) {
            const client = clients.find(c => c.id === id);
            if (client) {
                Object.assign(client, data);
                saveClients();
                return true;
            }
            return false;
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞ (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∞)
        function deleteClient(id) {
            if (currentUser.role !== 'admin') {
                alert('–¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç —É–¥–∞–ª—è—Ç—å –∫–ª–∏–µ–Ω—Ç–æ–≤');
                return;
            }

            const client = clients.find(c => c.id === id);
            if (!client) return;

            const confirmDelete = confirm(
                `–£–¥–∞–ª–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞?\n\n${client.lastName} ${client.firstName} ${client.middleName}\n\n` +
                `–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–∞—Å—á–µ—Ç–æ–≤: ${client.calculations.length}\n` +
                `–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ!`
            );

            if (confirmDelete) {
                const index = clients.findIndex(c => c.id === id);
                if (index > -1) {
                    clients.splice(index, 1);
                    saveClients();
                    showAllClients();
                    console.log('–ö–ª–∏–µ–Ω—Ç —É–¥–∞–ª–µ–Ω:', id);
                }
            }
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–æ–≤ –≤ localStorage
        function saveClients() {
            localStorage.setItem('clients', JSON.stringify(clients));
            console.log('–ö–ª–∏–µ–Ω—Ç—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã:', clients.length);
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —Ñ–æ—Ä–º—É –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞
        function showClientForm() {
            editingClientId = null;
            document.getElementById('clientForm').classList.remove('hidden');
            document.getElementById('clientFormElement').reset();
            document.querySelector('#clientForm h3').textContent = '–ù–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç';
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —Ñ–æ—Ä–º—É —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞
        function editClient(id) {
            const client = clients.find(c => c.id === id);
            if (!client) return;

            editingClientId = id;
            document.getElementById('clientLastName').value = client.lastName;
            document.getElementById('clientFirstName').value = client.firstName;
            document.getElementById('clientMiddleName').value = client.middleName;
            document.getElementById('clientPhone').value = client.phone;
            document.getElementById('clientEmail').value = client.email;
            document.getElementById('clientAddress').value = client.address;

            document.getElementById('clientForm').classList.remove('hidden');
            document.querySelector('#clientForm h3').textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞';
        }

        // –°–∫—Ä—ã—Ç—å —Ñ–æ—Ä–º—É –∫–ª–∏–µ–Ω—Ç–∞
        function hideClientForm() {
            editingClientId = null;
            document.getElementById('clientForm').classList.add('hidden');
            document.getElementById('clientFormElement').reset();
        }

        // –ü–æ–∏—Å–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤ –ø–æ –§–ò–û
        function searchClients() {
            const query = document.getElementById('searchInput').value.trim().toLowerCase();

            if (!query) {
                showAllClients();
                return;
            }

            const results = clients.filter(client => {
                const fullName = `${client.lastName} ${client.firstName} ${client.middleName}`.toLowerCase();
                return fullName.includes(query);
            });

            displayClients(results);
            console.log(`–ü–æ–∏—Å–∫ "${query}": –Ω–∞–π–¥–µ–Ω–æ ${results.length} –∫–ª–∏–µ–Ω—Ç–æ–≤`);
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—Å–µ—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤
        function showAllClients() {
            displayClients(clients);
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤
        function displayClients(clientsList) {
            const container = document.getElementById('clientsList');

            if (clientsList.length === 0) {
                container.innerHTML = '<p class="message info">–ö–ª–∏–µ–Ω—Ç–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.</p>';
                return;
            }

            let html = '';
            clientsList.forEach(client => {
                const fullName = `${client.lastName} ${client.firstName} ${client.middleName}`.trim();
                const createdDate = new Date(client.createdAt).toLocaleDateString('ru-RU');

                html += '<div class="card">';
                html += `<div class="card-title">${fullName}</div>`;
                html += '<div class="card-content">';

                if (client.phone) {
                    html += `<div>üìû ${client.phone}</div>`;
                }
                if (client.email) {
                    html += `<div>üìß ${client.email}</div>`;
                }
                if (client.address) {
                    html += `<div>üìç ${client.address}</div>`;
                }

                html += `<div style="margin-top: 8px; color: #999; font-size: 12px;">`;
                html += `–°–æ–∑–¥–∞–Ω: ${createdDate} | –†–∞—Å—á–µ—Ç–æ–≤: ${client.calculations.length}`;
                html += `</div>`;
                html += '</div>';

                html += '<div style="margin-top: 10px;">';
                html += `<button onclick="selectClient('${client.id}')" class="success">–í—ã–±—Ä–∞—Ç—å –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞</button>`;
                html += `<button onclick="editClient('${client.id}')" class="secondary">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>`;
                html += `<button onclick="viewClientCalculations('${client.id}')" class="secondary">–ò—Å—Ç–æ—Ä–∏—è</button>`;

                if (currentUser.role === 'admin') {
                    html += `<button onclick="deleteClient('${client.id}')" class="danger">–£–¥–∞–ª–∏—Ç—å</button>`;
                }

                html += '</div>';
                html += '</div>';
            });

            container.innerHTML = html;
        }

        // –í—ã–±–æ—Ä –∫–ª–∏–µ–Ω—Ç–∞ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞
        function selectClient(clientId) {
            const client = clients.find(c => c.id === clientId);
            if (!client) {
                alert('–ö–ª–∏–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω');
                return;
            }

            // –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞
            createNewCalculation(clientId);

            // –ü–µ—Ä–µ—Ö–æ–¥ –∫ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä—É
            showSection('calculator');
        }

        // –ü—Ä–æ—Å–º–æ—Ç—Ä –∏—Å—Ç–æ—Ä–∏–∏ —Ä–∞—Å—á–µ—Ç–æ–≤ –∫–ª–∏–µ–Ω—Ç–∞
        function viewClientCalculations(clientId) {
            const client = clients.find(c => c.id === clientId);
            if (!client) return;

            // –ë—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ —Å–ª–µ–¥—É—é—â–∏—Ö –±–ª–æ–∫–∞—Ö
            alert(`–ò—Å—Ç–æ—Ä–∏—è —Ä–∞—Å—á–µ—Ç–æ–≤ –¥–ª—è "${client.lastName} ${client.firstName}" –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤ —Å–ª–µ–¥—É—é—â–∏—Ö –±–ª–æ–∫–∞—Ö`);
            console.log('–ü—Ä–æ—Å–º–æ—Ç—Ä –∏—Å—Ç–æ—Ä–∏–∏ –∫–ª–∏–µ–Ω—Ç–∞:', clientId);
        }

        // ========================================
        // –ó–ê–ì–õ–£–®–ö–ò –î–õ–Ø –°–õ–ï–î–£–Æ–©–ò–• –ë–õ–û–ö–û–í
        // ========================================

        // ========================================
        // –ó–ê–ü–£–°–ö –ü–†–ò –ó–ê–ì–†–£–ó–ö–ï –°–¢–†–ê–ù–ò–¶–´
        // ========================================

        window.addEventListener('load', function() {
            checkAuth();
            console.log('–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∫—É—Ö–Ω–∏ MVP - –ë–ª–æ–∫ 2 –≥–æ—Ç–æ–≤');
        });
    </script>
</body>
</html>
